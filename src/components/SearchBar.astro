---
interface Props {
  placeholder?: string;
  categories?: Array<{
    id: string;
    name: string;
    slug: string;
  }>;
  mobileFriendly?: boolean;
}

const { 
  placeholder = "Buscar produtos...", 
  categories = [],
  mobileFriendly = false
} = Astro.props;
---

<div class={`search-container bg-white rounded-xl shadow-hover p-1 relative z-50 ${mobileFriendly ? 'mobile-friendly' : ''}`}>
  <div class="flex items-center flex-wrap md:flex-nowrap">
    <!-- Ícone de busca -->
    <div class="pl-4 text-primary-500">
      <i class="fas fa-search text-lg"></i>
    </div>
    
    <!-- Campo de busca -->
    <div class="flex-grow">
      <input 
        type="text" 
        id="searchInput" 
        placeholder={placeholder} 
        class="w-full py-3 px-3 text-neutral-700 bg-transparent border-none focus:outline-none focus:ring-0 placeholder-neutral-400 text-lg"
        autocomplete="off"
      />
    </div>
    
    <!-- Botão de categorias (visível apenas se houver categorias) -->
    {categories && categories.length > 0 && (
      <div class="relative group">
        <button 
          id="categoryDropdownButton" 
          class="flex items-center gap-2 py-3 px-4 text-primary-700 hover:text-primary-800 font-medium transition-colors rounded-lg hover:bg-primary-50"
        >
          <i class="fas fa-tag"></i>
          <span>Categorias</span>
          <i class="fas fa-chevron-down text-xs transition-transform group-hover:rotate-180"></i>
        </button>
        
        <!-- Dropdown de categorias -->
        <div 
          id="categoryDropdown" 
          class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-neutral-100 hidden z-50 overflow-hidden"
        >
          <div class="py-2 max-h-80 overflow-y-auto">
            <button 
              data-category="all" 
              data-name="Todos" 
              class="category-dropdown-item w-full text-left px-4 py-2 hover:bg-primary-50 text-neutral-700 hover:text-primary-700 transition-colors flex items-center gap-2"
            >
              <i class="fas fa-border-all text-primary-400"></i>
              <span>Todos os produtos</span>
            </button>
            
            <div class="border-t border-neutral-100 my-1"></div>
            
            {categories.map(category => (
              <button 
                data-category={category.slug} 
                data-name={category.name} 
                class="category-dropdown-item w-full text-left px-4 py-2 hover:bg-primary-50 text-neutral-700 hover:text-primary-700 transition-colors flex items-center gap-2"
              >
                <i class="fas fa-tag text-primary-400"></i>
                <span>{category.name}</span>
              </button>
            ))}
          </div>
        </div>
      </div>
    )}
    
    <!-- Botão de busca -->
    <button 
      id="searchButton" 
      class="bg-primary-600 hover:bg-primary-700 text-white py-3 px-6 rounded-lg transition-colors ml-2 flex items-center gap-2"
    >
      <span class="hidden sm:inline">Buscar</span>
      <i class="fas fa-arrow-right"></i>
    </button>
  </div>
  
  <!-- Chips de filtros ativos (inicialmente escondidos) -->
  <div id="activeFilters" class="flex flex-wrap gap-2 pt-3 px-4 pb-2 hidden">
    <!-- Os chips serão adicionados via JavaScript -->
  </div>
</div>

<script>
  import { SearchBarController } from './SearchBarController.js';
  
  document.addEventListener('DOMContentLoaded', () => {
    // Inicializar o controlador da barra de pesquisa
    new SearchBarController();
  });
</script>

<style>
  /* Animação para o dropdown */
  #categoryDropdown {
    transform-origin: top right;
    transition: opacity 0.2s, transform 0.2s;
    opacity: 0;
    transform: scale(0.95);
  }
  
  #categoryDropdown:not(.hidden) {
    opacity: 1;
    transform: scale(1);
  }
  
  /* Estilo para o scrollbar do dropdown */
  #categoryDropdown div::-webkit-scrollbar {
    width: 6px;
  }
  
  #categoryDropdown div::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  
  #categoryDropdown div::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 10px;
  }
  
  #categoryDropdown div::-webkit-scrollbar-thumb:hover {
    background: #ccc;
  }
  
  /* Animação de fade para o grid de produtos */
  @keyframes fade {
    0% { opacity: 0.7; }
    100% { opacity: 1; }
  }
  
  .animate-fade {
    animation: fade 0.5s ease-in-out;
  }
  
  /* Animação para os cards de produto */
  @keyframes fadeIn {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  
  .animate-fade-in {
    animation: fadeIn 0.3s ease-out forwards;
  }
  
  /* Estilos específicos para mobile */
  @media (max-width: 640px) {
    .mobile-friendly input {
      font-size: 16px; /* Evita zoom automático em iOS */
      padding: 0.75rem 0.5rem;
    }
    
    .mobile-friendly #categoryDropdownButton {
      padding: 0.75rem 0.5rem;
    }
    
    .mobile-friendly #searchButton {
      padding: 0.75rem 1rem;
    }
  }
</style>
